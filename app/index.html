<html>
<head>
<title>WebM Dashboard</title>
<link rel="stylesheet" type="text/css" href="/css/main.css"/>

<!-- The majority of our javascript -->
<script type="text/javascript" src="/js/jstree/_lib/jquery.js"></script>
<script type="text/javascript" src="/js/jstree/jquery.jstree.js"></script>
<link rel="stylesheet" type="text/css" href="/js/jquery-ui/css/smoothness/jquery-ui-1.8.21.custom.css" />
<script type="text/javascript" src="/js/jquery-ui/js/jquery-ui-1.8.21.custom.min.js"></script>
<script type="text/javascript" src="/js/treehandler.js"></script>

<!-- Making an AJAX request to a local server function ------------------------>
<script type="text/javascript" src="/js/json2.js"></script>
<script type="text/javascript">
//
// As mentioned at http://en.wikipedia.org/wiki/XMLHttpRequest
//
if( !window.XMLHttpRequest ) XMLHttpRequest = function()
{
  try{ return new ActiveXObject("Msxml2.XMLHTTP.6.0") }catch(e){}
  try{ return new ActiveXObject("Msxml2.XMLHTTP.3.0") }catch(e){}
  try{ return new ActiveXObject("Msxml2.XMLHTTP") }catch(e){}
  try{ return new ActiveXObject("Microsoft.XMLHTTP") }catch(e){}
  throw new Error("Could not find an XMLHttpRequest alternative.")
};

//
// Makes an AJAX request to a local server function w/ optional arguments
//
// functionName: the name of the server's AJAX function to call
// opt_argv: an Array of arguments for the AJAX function
//
function Request(function_name, opt_argv) {

  if (!opt_argv)
    opt_argv = new Array();

  // Find if the last arg is a callback function; save it
  var callback = null;
  var len = opt_argv.length;
  if (len > 0 && typeof opt_argv[len-1] == 'function') {
    callback = opt_argv[len-1];
    opt_argv.length--;
  }
  var async = (callback != null);

  // Encode the arguments in to a URI
  var query = 'action=' + encodeURIComponent(function_name);
  for (var i = 0; i < opt_argv.length; i++) {
    var key = 'arg' + i;
    var val = JSON.stringify(opt_argv[i]);
    query += '&' + key + '=' + encodeURIComponent(val);
  }
  query += '&time=' + new Date().getTime(); // IE cache workaround

  // Create an XMLHttpRequest 'GET' request w/ an optional callback handler
  var req = new XMLHttpRequest();
  req.open('GET', '/rpc?' + query, async);

  if (async) {
    req.onreadystatechange = function() {
      if(req.readyState == 4 && req.status == 200) {
        var response = null;
        try {
          response = JSON.parse(req.responseText);
        } catch (e) {
          response = req.responseText;
        }
        callback(response);
      }
    }
  }

  // Make the actual request
  req.send(null);
}

// Adds a stub function that will pass the arguments to the AJAX call
function InstallFunction(obj, functionName) {
  obj[functionName] = function() { Request(functionName, arguments); }
}

</script>

<script type="text/javascript">

// Server object that will contain the callable methods
var server = {};

// Insert 'Add' as the name of a callable method
InstallFunction(server, 'GetTreeData');

// Client function that calls a server rpc and provides a callback
function doGetTreeData() {
  server.GetTreeData(onGetDataSuccess);
}

// Callback for after a successful doAdd
function onGetDataSuccess(response) {
  document.getElementById('result').value = response;
}

</script>
<!-- ----------------------------------------------------------------------- -->
</head>

<body>

<div id ="main"> <!-- This div exists to test some Jquery binding things -->
<h1>Welcome!</h1>

<div id="top">

<div id="topcolumn">
  <div id="treeView1">
  </div>
</div>

<div id="topcolumn">
  <div id="treeView2">
  </div>
</div>

<div id="topcolumn">
  <div id="treeView3">
  </div>
</div>

</div> <!-- end of top -->

<div id="bottomcenter">

<!-- the tab widget -->
<div id="tabs">
  <ul class="tabnav">
    <li><a href="#tabs1">Selection from Tree 1</a></li>
    <li><a href="#tabs2">Selection from Tree 2</a></li>
    <li><a href="#tabs3">Notes</a></li>
  </ul>

  <div id="tabs1" class="tabdiv">
  </div>
  <div id="tabs2" class="tabdiv">
  </div>
  <div id="tabs3" class="tabdiv">
    <p>Lorem ipsum etc.</p>
  </div>

</div> <!-- end of tabs -->

<div id="clearer">
  <h3> Click here to clear all boxes. </h3>
</div>

<!--
<div id="button">
<input type="button" value="Test Ajax Calling Functionality" onclick="doGetTreeData()" />
</div>
<br>
Result: <input id="result" type="text" value="" readonly="true" disabled="true" /></td>
-->


</div> <!-- end of main -->


</body>
</html>
