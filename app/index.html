<html>
<head>
<title>WebM Dashboard</title>
<link rel="stylesheet" type="text/css" href="/css/main.css"/>

<!-- The majority of our javascript -->
<script type="text/javascript" src="/js/jstree/_lib/jquery.js"></script>
<script type="text/javascript" src="/js/jstree/jquery.jstree.js"></script>
<link rel="stylesheet" type="text/css" href="/js/jquery-ui/css/smoothness/jquery-ui-1.8.21.custom.css" />
<script type="text/javascript" src="/js/jquery-ui/js/jquery-ui-1.8.21.custom.min.js"></script>

<!-- Making an AJAX request to a local server function ------------------------>
<script type="text/javascript" src="/js/json2.js"></script>
<script type="text/javascript">

var MetricState = new Array();
var ConfigState = new Array();
var FileState = new Array();
var CommitState = new Array();

</script>
<script type="text/javascript" src="/js/treehandler.js"></script>

<!-- the AJAX API for google charts -->
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script>
google.load('visualization', '1.0', {'packages':['corechart', 'table']});

function ChartFiller() {
  var response1;

  // Wait until all data is fetched to generate graphs
  $(document).ajaxStop(function() {
    $(this).unbind("ajaxStop");
    if (response1) {
      drawChart(response1, response1);
    }
    else {
      $('#tabs1').html("Not a valid run");
    }
  });

  // We put together a url
  var metric = MetricState[0];
  var config = ConfigState[0];
  var file = FileState[0];
  var commit = CommitState[0];

  $.ajax({
    type: "GET",
    url: "/metric-data/" + metric + "/" + config + "/" + file + "/" + commit,
    success: function(response){
      response1 = response;
    },
  });
}

function drawChart(data_in1, data_in2) {
  var data1 = new google.visualization.DataTable();
  data1.addColumn('number', 'X');
  data1.addColumn('number', 'Y');
  data1.addRows(data_in1);

  var data2 = new google.visualization.DataTable();
  data2.addColumn('number', 'X');
  data2.addColumn('number', 'Z');
  data2.addRows(data_in2);

  // Join the two tables into one view
  var view = new google.visualization.data.join(data1, data2, 'full', [[0,0]], [1], [1]);
  //$("#result").text(view.toJSON());

  // Set chart options
  var options = {title:'Test Graph',
                 width:400,
                 height:300,
                 hAxis: {title: 'x axis'},
                 vAxis: {title: 'y axis'},
                 'pointSize':2,
                 'lineWidth':1,
                 'interpolateNulls':true,
                };

  // Instantiate and draw our chart, passing in some options.
  var chart = new google.visualization.LineChart(document.getElementById('tabs1'));
  var table = new google.visualization.Table(document.getElementById('tabs2'));
  chart.draw(view, options);
  table.draw(view, options);
}

</script>


<!-- ----------------------------------------------------------------------- -->
</head>

<body>

<div id ="main"> <!-- This div exists to test some Jquery binding things -->
<h1>Welcome!</h1>

<div id="top">

<div id="topcolumn">
  <div id="treeView1">
  </div>
</div>

<div id="topcolumn">
  <div id="treeView2">
  </div>
</div>

<div id="topcolumn">
  <div id="treeView3">
  </div>
</div>

<div id="topcolumn">
  <div id="treeView4">
  </div>
</div>

</div> <!-- end of top -->

<div id="bottomcenter">

<!-- the tab widget -->
<div id="tabs">
  <ul class="tabnav">
    <li><a href="#tabs1">Selection from Tree 1</a></li>
    <li><a href="#tabs2">Selection from Tree 2</a></li>
    <li><a href="#tabs3">Notes</a></li>
  </ul>

  <div id="tabs1" class="tabdiv">
  </div>
  <div id="tabs2" class="tabdiv">
  </div>
  <div id="tabs3" class="tabdiv">
    <p>Lorem ipsum etc.</p>
  </div>

</div> <!-- end of tabs -->

<div id="clearer">
  <h3> Click here to clear all boxes. </h3>
</div>


<!-- 
<div id="button">
<input type="button" value="Test Ajax Calling Functionality" onclick="RequestTest()" />
</div>
<br>
<div id="result">
Hello
</div>
-->


</div> <!-- end of main -->


</body>
</html>
